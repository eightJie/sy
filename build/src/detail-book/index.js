/*! sy 2015-03-17 */
$(function(){function a(){b(),c(function(){d(),e()})}function b(){window.d={id:h,showImg:function(a){return a=a||"imgs/default.png",' style="background-image:url('+a+');" '}}}function c(a){$.ajax({url:f("/w/view_onebook.do"),dataType:"jsonp",success:function(b){var c=b.res.data,d=_.template($("#J-tmpl-page").html());$("#J-page-container").html(d(c)),a&&a()},error:function(){}})}function d(){$.ajax({url:HOST+"/w/view_onebookdigest.do",dataType:"jsonp",data:{id:h,page:0,lastId:0},success:function(a){var b=a.res.data,c=_.template($("#J-summary-tmpl").html());$("#J-summary-container").html(c(b))},error:function(){}})}function e(){new loadingPage("#J-comments-container","#J-comments-tmpl",function(a,b,c){$.ajax({url:HOST+"/w/view_onebookcommentlist.do",dataType:"jsonp",data:{id:h,type:0,lastId:b},success:function(a){var b=a.res.data;$("#J-comments-total").html(b.total||b.list.length),c&&c(b.list)},error:function(){}})}).start()}function f(a){return HOST+a+i}function g(a,b){var c=new RegExp("(^|&)"+a+"=([^&]*)(&|$)","i"),d=location.search.substr(1).match(c);return b&&d?escape(d[2]):""}var h,i=location.search;h=g("id",i),a()}),function(a){function b(a,b,c){this.container=$(a),this.$tmpl=$(b),this.getData=c,this.pageNum=1,this.loading=!1}var c=$(a),d=a.scrollY,e=c.height();b.prototype={start:function(){var a=this;a._getData(),this._addEvents()},_addEvents:function(){},_scroll:function(){var b,c=this,f=a.scrollY,g=f>=$(document).height()-e;b=f>d?"up":"down",d=f,!c.loading&&"up"==b&&g&&c._getData()},_getData:function(){var a=this,b=a.pageNum,c=a.lastId||0;return a.loading?!1:(a.loading=!0,void a.getData(b,c,function(b){a.loading=!1,a.lastId=b[b.length-1].ridStr,a.container.append(_.template(a.$tmpl.html())({list:b}))}))}},a.loadingPage=b}(window);