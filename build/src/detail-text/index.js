/*! sy 2015-03-18 */
$(function(){function a(){c(),b(function(){f(),d(),e(),$("#J-tab-nav>li").on("click",function(){var a=$(this),b=a.attr("id").match(/\d+/)[0],c=$("#tab-content-"+b);a.parent().children().removeClass("active"),a.addClass("active"),$("#J-tab-content").children().css("display","none"),c.css("display","block")})})}function b(a){$.ajax({url:HOST+"/w/view_oneresourcecomment.do",dataType:"jsonp",data:{id:h,type:3},success:function(b){var c=b.res.data,d=_.template($("#J-tmpl-page").html());$("#J-page-container").html(d(c)),a&&a()},error:function(){}})}function c(){window.getText=function(a){var b=a.content,c=a.oList;return!b||b.indexOf("http://")>-1?"":c?(_.each(c,function(a){var c=(6==a.type?"detail-book.html":"detail-movie.html")+"?id="+a.id;b=b.replace(new RegExp("(《?"+a.name+"》?)"),'<a style="color: #28a5dc;" href="'+c+'">$1</a>')}),b):b}}function d(){$.ajax({url:HOST+"/w/view_onecommentlist.do",dataType:"jsonp",data:{id:h,type:1,lastId:0},success:function(a){var b=a.res.data,c=_.template($("#J-comments-tmpl").html());$("#J-comments-num").html(b.list.length),$("#tab-content-1").html(c(b))},error:function(){}})}function e(){$.ajax({url:HOST+"/w/view_onecommentlist.do",dataType:"jsonp",data:{id:h,type:2,lastId:0},success:function(a){var b=a.res.data,c=_.template($("#J-favours-tmpl").html());$("#J-favours-num").html(b.list.length),$("#tab-content-2").html(c(b))},error:function(){}})}function f(){function a(a){$("#swiper-num").html("<i>"+(a.activeIndex+1)+"</i><i>/</i><i>"+a.slides.length+"</i>")}function b(){var b=+$(this).attr("order");e.css("display","block"),f.css("display","none"),d=new Swiper(".swiper-container",{lazyLoading:!0,loop:!1,onSlideChangeEnd:function(){a(d)}}),d.activeIndex=b,d.onResize(),a(d),e.on("touchstart",function(a){var b,d=a.changedTouches[0].pageX,f=!1;e.on("touchmove",function(a){a.changedTouches.length>1&&(f=!0,e.off("touchmove"))}),e.on("touchend",function(a){b=a.changedTouches[a.changedTouches.length-1].pageX,Math.abs(b-d)<2&&!f&&c()})})}function c(){e.off("touchstart"),e.off("touchmove"),e.off("touchend"),d.destroy(),d=null,f.css("display","block"),e.css("display","none")}var d,e=$(".swiper-container"),f=$("#J-imgs");f.delegate(".J-item","tap",b)}function g(a,b){var c=new RegExp("(^|&)"+a+"=([^&]*)(&|$)","i"),d=location.search.substr(1).match(c);return b&&d?escape(d[2]):""}var h,i=location.search;h=g("id",i),a()});